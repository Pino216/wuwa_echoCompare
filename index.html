<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>鸣潮伤害分析与声骸词条对比工具 1.4</title>
    <script src="lib/chart.js"></script>
    <script src="lib/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="top-buttons">
        <div class="export-dropdown">
            <button class="btn export-btn export-btn-save" onclick="toggleExportMenu()">
                💾 保存配置 ▼
            </button>
            <div class="export-menu" id="exportMenu">
                <a href="javascript:void(0)" onclick="saveConfig(true, 'json')">保存并导出JSON文件</a>
                <a href="javascript:void(0)" onclick="saveConfig(true, 'xlsx')">保存并导出Excel文件</a>
                <a href="javascript:void(0)" onclick="saveConfig()">仅保存到本地存储</a>
            </div>
        </div>
        <button class="btn load-config-btn" onclick="loadConfig()">
            📂 加载配置
        </button>
        <input type="file" id="csvImport" class="hidden-file-input" onchange="importFullData(this)">
        <button class="btn reset-btn" onclick="location.reload()">
            🔄 重置页面
        </button>
    </div>

    <div class="grid">
        <div class="panel">
            <h2>1. 核心属性 (面板)</h2>
            <div class="input-row"><label>基础生命 / 总生命</label>
            <div><input type="number" id="base_hp" value="10000" style="width:60px"> / <input type="number" id="total_hp_now" value="20000" style="width:60px"></div></div>
            <div class="input-row"><label>基础攻击(角色+武器)</label><input type="number" id="base_atk" value="1000" style="width:70px"></div>
            <div class="input-row"><label>当前面板总攻击</label><input type="number" id="total_atk_now" value="2500" style="width:70px"></div>
            <div class="input-row"><label>基础防御 / 总防御</label>
            <div><input type="number" id="base_def" value="1000" style="width:50px"> / <input type="number" id="total_def_now" value="1500" style="width:50px"></div></div>
            <div class="input-row"><label>面板双暴%</label>
                <div><input type="number" id="base_cr" value="60" style="width:48px">% / <input type="number" id="base_cd" value="200" style="width:48px">%</div>
            </div>

            <div style="margin-top:10px; border-top: 1px solid rgba(139, 69, 19, 0.3); padding-top:10px;">
                <h3>面板固定伤害加成</h3>
                <div class="static-bonus-buttons">
                    <button class="btn add-static-bonus-btn" onclick="addStaticBonus()">+ 添加固定加成</button>
                    <button class="btn add-custom-type-btn" onclick="addCustomDamageType()">+ 添加自定义类型</button>
                    <button class="btn manage-custom-types-btn" onclick="showCustomTypes()">📋 管理自定义类型</button>
                </div>
                <div id="static_bonus_list"></div>
            </div>

            <h3>动态 Buff 轨道</h3>
            <div id="buff_pool"></div>
            <button class="btn add-new-buff-btn" onclick="addNewBuff()">+ 新增 Buff (每页最多显示8个)</button>
        </div>

        <div class="panel">
            <h2>2. 动作序列</h2>
            <div id="action_sequence" style="max-height: 450px; overflow-y: auto;"></div>
            <div class="add-action-container">
                <h3 class="add-action-title">添加新动作</h3>
                <div class="input-row add-action-inputs">
                    <input type="text" id="act_name" placeholder="动作名称" class="action-name-input">
                    <input type="number" id="act_mult" placeholder="倍率 %" class="action-mult-input">
                    <select id="act_type" class="action-type-select">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </select>
                    <select id="act_scaling" class="action-scaling-select">
                    <option value="atk">攻击力</option>
                    <option value="hp">生命值</option>
                    <option value="def">防御力</option></select>
                    <button class="btn add-action-btn" onclick="addAction()">
                        ✚ 插入动作
                    </button>
                </div>
                <div class="add-action-tip">
                    💡 提示：输入动作名称、倍率百分比并选择类型和基数
                </div>
            </div>
            <button class="btn btn-calc" onclick="calculate()">
                ⚡ 执行全量化分析
            </button>
            <div class="chart-container">
                <canvas id="dmgChart"></canvas>
            </div>

            <!-- 新增：伤害组成表格容器 -->
            <div id="damageComposition" class="damage-composition-container">
                <!-- 伤害组成表格将在这里动态生成 -->
            </div>
        </div>

        <div class="panel">
            <h2>3. 声骸副词条对比</h2>
            <p style="font-size:11px; color:#8b949e;">设置两个声骸的词条，对比其对最终输出的影响</p>

            <div class="echo-box" id="echo_a">
                <div class="echo-header">
                    <h3 class="echo-title echo-a-title">声骸 A</h3>
                    <div class="echo-equipped">
                        <input type="checkbox" id="echo_a_equipped" checked class="echo-checkbox">
                        <label for="echo_a_equipped" class="echo-checkbox-label">已装备</label>
                    </div>
                </div>
                <div class="echo-description">
                    副词条类型：普攻/重击/共鸣技能/共鸣解放/暴击/暴伤/攻击%/生命%/防御%等
                </div>
                <div class="substat-container"></div>
                <div class="echo-tips">
                    ✓ 默认已装备在角色身上<br>
                    ✓ 取消勾选表示声骸A未装备<br>
                    ✓ 对比时：已装备 → 计算替换为B的伤害变化<br>
                    ✓ 对比时：未装备 → 分别计算A和B相对于无声骸的提升
                </div>
            </div>

            <div class="echo-box" id="echo_b">
                <h3 class="echo-title echo-b-title">声骸 B</h3>
                <div class="echo-description echo-b-description">
                    副词条类型：普攻/重击/共鸣技能/共鸣解放/暴击/暴伤/攻击%/生命%/防御%等
                </div>
                <div class="substat-container"></div>
            </div>

            <!-- 声骸B替换影响分析容器 -->
            <div id="detailed_bonus_info" class="detailed-bonus-info">
                <!-- 声骸B替换声骸A的详细影响分析将在这里显示 -->
            </div>
            <div id="compare_res" class="compare-results">
                等待计算...
            </div>
        </div>
    </div>
</div>
<script src="script.js"></script>
</body>
</html>
