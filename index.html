<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>鸣潮伤害分析与声骸词条对比工具 1.4</title>
    <script src="lib/chart.js"></script>
    <script src="lib/xlsx.full.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="container">
    <div class="top-buttons">
        <div class="export-dropdown">
            <button class="btn export-btn" style="background:linear-gradient(135deg, #4a6bff, #6a8bff);" onclick="toggleExportMenu()">
                📤 导出方案 ▼
            </button>
            <div class="export-menu" id="exportMenu" style="display:none;">
                <a href="javascript:void(0)" onclick="selectExportFormat('json')">JSON格式（推荐备份）</a>
                <a href="javascript:void(0)" onclick="selectExportFormat('xlsx')">Excel格式（.xlsx）</a>
            </div>
        </div>
        <button class="btn" onclick="document.getElementById('csvImport').click()" style="background:linear-gradient(135deg, #ff6b8b, #ff8ba3);">
            📥 导入方案
        </button>
        <input type="file" id="csvImport" style="display:none" onchange="importFullData(this)">
        <button class="btn" onclick="saveToLocalStorage()" style="background:linear-gradient(135deg, #4caf50, #66bb6a);">
            💾 保存到本地
        </button>
        <button class="btn" onclick="loadFromLocalStorage()" style="background:linear-gradient(135deg, #2196f3, #42a5f5);">
            📂 从本地加载
        </button>
        <button class="btn" onclick="location.reload()" style="background:linear-gradient(135deg, #ff9800, #ffb74d); margin-left:auto;">
            🔄 重置页面
        </button>
    </div>

    <div class="grid">
        <div class="panel">
            <h2>1. 核心属性 (面板)</h2>
            <div class="input-row"><label>基础生命 / 总生命</label>
            <div><input type="number" id="base_hp" value="10000" style="width:50px"> / <input type="number" id="total_hp_now" value="20000" style="width:50px"></div></div>
            <div class="input-row"><label>基础攻击(角色+武器)</label><input type="number" id="base_atk" value="1000" style="width:70px"></div>
            <div class="input-row"><label>当前面板总攻击</label><input type="number" id="total_atk_now" value="2500" style="width:70px"></div>
            <div class="input-row"><label>基础防御 / 总防御</label>
            <div><input type="number" id="base_def" value="1000" style="width:50px"> / <input type="number" id="total_def_now" value="1500" style="width:50px"></div></div>
            <div class="input-row"><label>面板双暴%</label>
                <div><input type="number" id="base_cr" value="60" style="width:40px">% / <input type="number" id="base_cd" value="200" style="width:40px">%</div>
            </div>

            <div style="margin-top:10px; border-top: 1px solid rgba(139, 69, 19, 0.3); padding-top:10px;">
                <h3>面板固定伤害加成</h3>
                <div style="margin-bottom: 10px; display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" style="font-size:11px; background:linear-gradient(135deg, #4a6bff, #6a8bff); color:#fff;" onclick="addStaticBonus()">+ 添加固定加成</button>
                    <button class="btn" style="font-size:11px; background:linear-gradient(135deg, #ff9800, #ffb74d); color:#fff;" onclick="addCustomDamageType()">+ 自定义伤害类型</button>
                    <button class="btn" style="font-size:11px; background:linear-gradient(135deg, #ff6b8b, #ff8ba3); color:#fff;" onclick="showCustomTypes()">管理自定义类型</button>
                </div>
                <div id="static_bonus_list"></div>
            </div>

            <h3>动态 Buff 轨道</h3>
            <div id="buff_pool"></div>
            <button class="btn" style="width:100%; background:linear-gradient(135deg, #4a6bff, #6a8bff); color:#fff;" onclick="addNewBuff()">+ 新增 Buff</button>
        </div>

        <div class="panel">
            <h2>2. 动作序列</h2>
            <div id="action_sequence" style="max-height: 450px; overflow-y: auto;"></div>
            <div style="background: rgba(210, 180, 140, 0.15); padding: 15px; border-radius: 12px; margin-top:15px; border: 1px solid rgba(139, 69, 19, 0.3);">
                <h3 style="margin-top:0; margin-bottom:10px; color:#8B4513;">添加新动作</h3>
                <div class="input-row" style="flex-wrap:wrap; gap:8px;">
                    <input type="text" id="act_name" placeholder="动作名称" style="width:100px; flex:1;">
                    <input type="number" id="act_mult" placeholder="倍率 %" style="width:80px; flex:1;">
                    <select id="act_type" style="width:90px; flex:1;">
                        <!-- 选项将通过JavaScript动态生成 -->
                    </select>
                    <select id="act_scaling" style="width:90px; flex:1;">
                    <option value="atk">攻击力</option>
                    <option value="hp">生命值</option>
                    <option value="def">防御力</option></select>
                    <button class="btn" style="background:linear-gradient(135deg, #8B4513, #A0522D); color:#fff; flex:1; min-width:100px;" onclick="addAction()">
                        ✚ 插入动作
                    </button>
                </div>
                <div style="font-size:11px; color:#8B4513; margin-top:8px;">
                    💡 提示：输入动作名称、倍率百分比并选择类型和基数
                </div>
            </div>
            <button class="btn btn-calc" onclick="calculate()">
                ⚡ 执行全量化分析
            </button>
            <div style="height: 280px; margin-top:20px; background:rgba(210, 180, 140, 0.15); border-radius:12px; padding:15px; border:1px solid rgba(139, 69, 19, 0.3);">
                <canvas id="dmgChart"></canvas>
            </div>

            <!-- 新增：伤害组成表格容器 -->
            <div id="damageComposition" style="margin-top:20px; background:rgba(255, 255, 255, 0.9); border-radius:12px; padding:15px; border:1px solid rgba(139, 69, 19, 0.3); max-height: 300px; overflow-y: auto;">
                <!-- 伤害组成表格将在这里动态生成 -->
            </div>
        </div>

        <div class="panel">
            <h2>3. 声骸副词条对比</h2>
            <p style="font-size:11px; color:#8b949e;">设置两个声骸的词条，对比其对最终输出的影响</p>

            <div class="echo-box" id="echo_a">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px;">
                    <h3 style="margin-top:0; color:#8B4513">声骸 A</h3>
                    <div style="display: flex; align-items: center; gap: 6px;">
                        <input type="checkbox" id="echo_a_equipped" checked style="width: 16px; height: 16px;">
                        <label for="echo_a_equipped" style="font-size: 11px; color:#8B4513; cursor: pointer;">已装备</label>
                    </div>
                </div>
                <div style="font-size:11px; color:#8B4513; margin-bottom:8px;">
                    副词条类型：普攻/重击/共鸣技能/共鸣解放/暴击/暴伤/攻击%/生命%/防御%等
                </div>
                <div class="substat-container"></div>
                <div style="font-size:10px; color:#8B4513; margin-top:8px; padding:6px; background:rgba(139, 69, 19, 0.1); border-radius:4px;">
                    ✓ 默认已装备在角色身上，对比时计算替换为声骸B的伤害变化
                </div>
            </div>

            <div class="echo-box" id="echo_b">
                <h3 style="margin-top:0; color:#A0522D">声骸 B</h3>
                <div style="font-size:11px; color:#A0522D; margin-bottom:8px;">
                    副词条类型：普攻/重击/共鸣技能/共鸣解放/暴击/暴伤/攻击%/生命%/防御%等
                </div>
                <div class="substat-container"></div>
            </div>

            <div id="compare_res" style="background:rgba(210, 180, 140, 0.2); padding:15px; border-radius:12px; border:2px solid rgba(139, 69, 19, 0.4); max-height: 500px; overflow-y: auto;">
                等待计算...
            </div>
        </div>
    </div>
</div>
<script src="script.js"></script>
</body>
</html>
